# Workflow Builder - workflow.shivamshahi.tech
# Backend (API) on 8080, frontend static from build (or proxy to 3000 in dev)
# Enable: sudo ln -sf /home/ubuntu/Workflow-Builder/nginx/workflow.shivamshahi.tech.conf /etc/nginx/sites-available/workflow.shivamshahi.tech
#         sudo ln -sf /etc/nginx/sites-available/workflow.shivamshahi.tech /etc/nginx/sites-enabled/
#         sudo nginx -t && sudo systemctl reload nginx

server {
	listen 80;
	listen [::]:80;
	server_name workflow.shivamshahi.tech;

	# Frontend: serve built static files (run "npm run build" in frontend/)
	root /home/ubuntu/Workflow-Builder/frontend/build;
	index index.html;

	# API proxy to FastAPI backend (port 8080)
	location /api/ {
		proxy_pass http://127.0.0.1:8080/api/;
		proxy_http_version 1.1;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;
	}

	# SPA: serve index.html for client-side routes
	location / {
		try_files $uri $uri/ /index.html;
	}
}
